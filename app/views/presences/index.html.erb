<div class="pb-2 mt-6 mb-2 border-b">
  <h3><%= fa_icon 'file-signature' %> Émargements</h3>
</div>

<div class="bs-container mx-auto sm:px-4 max-w-full p-4 shadow-sm">
    <%= form_tag request.path, method: :get do %>
      <div class="flex flex-wrap">
        <div class="sm:w-1/4 px-4">
          <%= label_tag :search, "Rechercher" %>    
          <%= text_field_tag :search, params[:search], include_blank:true, onchange:'this.form.submit()', class:"input input-bordered w-full input-sm" %>
        </div>
        <div class="sm:w-1/4 px-4">
          <%= label_tag "Formation" %>
          <%= select_tag :formation_id, 
                              options_from_collection_for_select(Formation.unscoped.all, :id, :nom, params[:formation_id]), 
                              class: 'input input-bordered w-full input-sm select2', 
                              include_blank: true, 
                              onchange: 'this.form.submit()' %>
        </div>

      <div class="sm:w-1/12 px-4">
        <%= label_tag :ue, "U.E." %>   
        <%= select_tag :ue, options_for_select((0..20), params[:ue]), 
                        class: "input input-bordered w-full input-sm select2", 
                        include_blank:true, onchange: 'this.form.submit()' %>
      </div>

      <div class="sm:w-1/4 px-4">
        <%= label_tag "Intervenant" %>
        <%= select_tag :intervenant, grouped_options_for_select(Intervenant.for_select, params[:intervenant]), 
                        class: "input input-bordered w-full input-sm select2",
                        include_blank:true,
                        onchange: 'this.form.submit()' %>
      </div>

      <div class="sm:w-1/6 px-4">
        <%= label_tag :workflow_state, "État" %>
        <%= select_tag :workflow_state, 
                            options_for_select(Presence.workflow_spec.states.keys.to_a, params[:workflow_state]), 
                            include_blank: true,
                            class: 'input input-bordered w-full input-sm', 
                            onchange: 'this.form.submit()' %>
      </div>
      </div>
    <% end %>
</div>

<div style="overflow-x: auto;">
  <%= form_tag action_presences_path, name: 'action' do %>
    <div data-controller="check-all action">
      <table class="table table-zebra table-sm">
        <thead>
          <tr>
            <th>
              <span data-action="click->action#click">
                <input type="checkbox" data-target="check-all.all action.source">
              </span>
            </th>
            <th>Il y a</th>
            <th>Date signature</th>
            <th>Formation</th>
            <th>Intervenant</th>
            <th>Cours</th>
            <th>UE</th>
            <th>Nom / Prénom</th>
            <th>Signature</th>
            <th>État</th>
            <th colspan="2"></th>
          </tr>
        </thead>

        <tbody>
          <%= render partial: 'presence', collection: @presences %>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="10"></td>
          </tr>
        </tfoot>
      </table>

      <div data-target="action.selector">
          <%= select_tag :action_name, options_for_select(["Signer", "Valider", "Rejeter", "Supprimer"]), 
                          include_blank: true,
                          class: "input input-bordered w-full input-sm sm:w-1/4 px-4 mb-4 inline" %>
          <%= submit_tag "Valider", class:'btn btn-danger btn-sm ml-4' %>
      </div>
    </div>
  <% end %>
</div>

<div class="page_info mb-6">
  <%= page_entries_info @presences %>
  <%= JSON.pretty_generate(Presence.workflow_states_count(@presences)) %>
</div>

<%= will_paginate @presences, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>