<div class="pb-2 mt-4 mb-2 border-bottom">
  <h3><%= fa_icon 'file-signature' %> Présences</h3>
</div>

<div class="container-fluid p-3 shadow-sm">
    <%= form_tag request.path, method: :get do %>
      <div class="form-group">
        <div class="row">
          <div class="col-sm-4">
            <%= label_tag :search, "Rechercher" %>    
            <%= text_field_tag :search, params[:search], include_blank:true, onchange:'this.form.submit()', class:"form-control form-control-sm" %>
          </div>
          <div class="col-sm-3">
            <%= label_tag "Formation" %>
            <div class="input-group">
              <%= select_tag :formation_id, 
                                  options_from_collection_for_select(Formation.unscoped.all, :id, :nom, params[:formation_id]), 
                                  class: 'form-control form-control-sm select2', 
                                  include_blank: true, 
                                  onchange: 'this.form.submit()' %>
            </div>
          </div>

          <div class="col-sm-3">
            <%= label_tag "Intervenant" %>
            <div class="input-group">
              <%= select_tag :intervenant, grouped_options_for_select(Intervenant.for_select, params[:intervenant]), 
                              class: "form-control form-control-sm select2",
                              include_blank:true,
                              onchange: 'this.form.submit()' %>
            </div>
          </div>

          <div class="col-sm-2">
            <%= label_tag :workflow_state, "État" %>
            <%= select_tag :workflow_state, 
                                options_for_select(Presence.workflow_spec.states.keys.to_a, params[:workflow_state]), 
                                include_blank: true,
                                class: 'form-control form-control-sm', 
                                onchange: 'this.form.submit()' %>
          </div>
        </div>
      </div>  
    <% end %>
</div>

<div style="overflow-x: auto;">
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>Il y a</th>
        <th>Date</th>
        <th>Formation</th>
        <th>Intervenant</th>
        <th>Cours</th>
        <th>UE</th>
        <th>Étudiant</th>
        <th>Signature</th>
        <th>État</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @presences.each do |presence| %>
        <tr>
          <td><%= time_ago_in_words presence.created_at %></td>
          <td><%= l presence.created_at, format: :long %></td>
          <td><%= presence.cour.formation.nom %></td>
          <td><%= presence.cour.intervenant.nom_prenom %></td>
          <td><%= presence.cour.nom_ou_ue %></td>
          <td><%= presence.code_ue %></td>
          <td>
            <% if presence.role == 'étudiant' %>
              <%= presence.user.nom_et_prénom %>
              <br>
              <span class="<%= presence.style_ip %>"><%= presence.ip%></span>
            <% end %>
          </td>
          <td><img src=<%= presence.signature %> style="width: 50px;"></td>
          <td><span class="badge <%= presence.style %>"><%= presence.workflow_state.humanize %></span></td>
          <td><%= link_to 'Voir', presence %></td>
          <td><%= link_to '[X]', presence, method: :delete, data: { confirm: 'Êtes-vous sûr ?' } %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="11"></td>
      </tr>
    </tfoot>
  </table>
</div>

<div class="page_info">
  <%= page_entries_info @presences %>
</div>

<%= will_paginate @presences, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>